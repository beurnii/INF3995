stages:
    - build
    - lint
    - test

cache:
    paths:
        - server/build
        - desktop/build

################
# Build Stages #
################

build-server:
    stage: build
    image: rikorose/gcc-cmake
    script:
        - cd server && ./build.sh

build-desktop:
    stage: build
    image: gradle:jdk12
    script:
        - cd desktop && gradle build

###############
# Lint Stages #
###############

lint-server:
    stage: lint
    image: teeks99/clang-ubuntu
    # allow_failure: true
    script:
        - cd server && clang-format-8 -style=file src/*.cc -output-replacements-xml | grep "<replacement "

###############
# Test Stages #
###############

test-server:
    stage: test
    image: rikorose/gcc-cmake
    script:
        - cd server && echo "TODO"

test-desktop:
    stage: test
    image: gradle:jdk12
    script:
        - cd desktop && gradle test
