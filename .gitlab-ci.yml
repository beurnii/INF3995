stages:
    - build
    - test
    - lint

cache:
    paths:
        - server/build
        - desktop/build

################
# Build Stages #
################

build-server:
    stage: build
    image: teeks99/clang-ubuntu
    script:
        - apt-get install --yes cmake
        - cd server && ./build.sh
        - chmod +x clang.sh &&./clang.sh tidy -3.8

build-desktop:
    stage: build
    image: gradle:jdk12
    script:
        - cd desktop && gradle build

###############
# Test Stages #
###############

test-server:
    stage: test
    image: rikorose/gcc-cmake
    script:
        - cd server && echo "TODO"

test-desktop:
    stage: test
    image: gradle:jdk12
    script:
        - cd desktop && gradle test

###############
# Lint Stages #
###############

lint-server:
    stage: lint
    image: ethereum/cpp-build-envy
    script:
        - cd server && chmod +x clang.sh &&./clang.sh format -8
